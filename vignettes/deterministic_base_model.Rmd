---
title: "Run a base model"
author: "Lorenzo Cattarino"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Run a base model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Running the base model
Here we consider a deterministic model without seasonality and interventions. The model has an age-stratified human host populations with 11 human age groups. To run the model we need to define some objects first, such as:

* the width of each human age groups;
* the mortality rate in each age group, and
* the length of time we want to run the model for.

```{r}
library(ZikaModel)

age_init <- c(1, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10)
  
deathrt <- c(1e-10, 
             1e-10, 
             1e-10, 
             0.00277068683332695, 
             0.0210680857689784,
             0.026724997685722,
             0.0525354529367476,
             0.0668013582441452,
             0.119271483740379,
             0.279105747097929,
             0.390197266957464)

# number of years to run the simulation for
time_years <- 50 # years

# time step
my_dt <- 1

# number of model time steps
time_frame <- (364 * time_years) / my_dt
```

We run the deterministic version of the model with `run_model()`. Note that the `nn_links` and `amplitudes_phases` objects are datasets of the nearest neighboring patches to each patch and the amplitude and phase of seasonal forcing in each patch, respectively, and are provided with the package.

```{r}
model_outputs <- run_model(agec = age_init,
                           death = deathrt,
                           nn_links = nn_links,
                           amplitudes_phases = amplitudes_phases,
                           time = time_frame)
```

We can calculate the proportions of the total human population in each compartment 
and few other useful demographics of the human host population using the `post_processing` function

```{r}
diagnostics <- post_processing(model_outputs, my_dt)
```

The demographic diagnostics of the vector population can be calculated with the `post_processing_mos` function

```{r}
mosquito_diagnostics <- post_processing_mos(model_outputs)
```

Now we plot all the diagnostics

```{r, fig.height = 4, fig.width = 6}
plot_compartments(diagnostics$compartments)
```

```{r, fig.height = 6, fig.width = 8}
plot_demographics(diagnostics$demographics)
```

```{r, fig.height = 6, fig.width = 8}
plot_demographics(mosquito_diagnostics)
```
