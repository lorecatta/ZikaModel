---
title: "Run a stochastic model"
author: "Lorenzo Cattarino"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Run a stochastic model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, echo = FALSE}
library(ZikaModel)
```

## Stochasticity 
The `ZIkaModel` package implements also a stochastic version of the Zika 
tranmsission model. To avoid confusion, the stochastic version of the model is 
written as a different odin source file. To run the stochastic model, we need 
to create a `model generator`, which is a function that will generate an 
instance of the stochastic model, using the specified path to the odin source file.

The following code will do this:

```{r}
# path to odin source file
odin_model_path <- system.file("extdata/odin_model_stoch.R", package = "ZikaModel")
  
create_generator <- ZikaModel::create_r_model(odin_model_path,
                                              agec,
                                              death,
                                              nn_links,
                                              season = TRUE)

gen <- create_generator$generator(user = generator$state)
```

Now define the required objects to run the model and run it.

```{r}
# create a vector of human age groups 
age_init <- c(1, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10)
  
# create a vector of human mortality rates 
deathrt <- c(1e-10, 
             1e-10, 
             1e-10, 
             0.00277068683332695, 
             0.0210680857689784,
             0.026724997685722,
             0.0525354529367476,
             0.0668013582441452,
             0.119271483740379,
             0.279105747097929,
             0.390197266957464)
             
# provide the length of time (in days) that you want to run the model for
time_frame <- 364 * 100

# runs the model
model_run <- gen$run(t = seq(0, time_frame, 1))
```
